var __assign=(this&&this.__assign)||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var SPD=(function(){function SPD(opts){var _this=this;this.opts={entryName:'',};this._spdRate=1;this._spdTiming={};this._firtTime=[];this._renderId=0;this._isSampling=true;this.report=false;this.init=function(opts){_this.opts=opts;_this._spdRate=opts.spdRate||1;_this._spdTiming={};_this._firtTime=[];_this._renderId=0;_this._isSampling=_this.isSamplingSuccess();setTimeout(function(){var _a,_b;if(_this._isSampling&&_this.opts.entryName){_this.sendFirstTime();(_b=(_a=_this.opts).getFirstTime)===null||_b===void 0?void 0:_b.call(_a,_this._spdTiming)}},opts.timeOut||2000);_this._isSampling&&_this.opts.entryName&&_this.decoratorLogTime(Hippy.bridge,'callNative')};this.checkRate=function(){return _this._spdRate<=1?true:Math.round(Math.random()*_this._spdRate)<1};this.decoratorLogTime=function(target,key){var oldDescriptor=Object.getOwnPropertyDescriptor(target,key);var logTime=function(){var arg=[];for(var _i=0;_i<arguments.length;_i++){arg[_i]=arguments[_i]}try{return oldDescriptor===null||oldDescriptor===void 0?void 0:oldDescriptor.value.apply(_this,arg)}finally{if(!_this.report&&arg[1]=='startBatch'){_this._firtTime[_this._renderId]={points:0,}}if(!_this.report&&arg[1]=='endBatch'){!_this._firtTime[_this._renderId]&&(_this._firtTime[_this._renderId]={points:0,});_this._firtTime[_this._renderId].timestamp=Date.now();_this._renderId++}if(!_this.report&&arg[1]=='createNode'){var points=_this.getNodesPoints(arg[3]);!_this._firtTime[_this._renderId]&&(_this._firtTime[_this._renderId]={points:0,});points>_this._firtTime[_this._renderId].points&&(_this._firtTime[_this._renderId].points=points)}}};Object.defineProperty(target,key,__assign(__assign({},oldDescriptor),{value:logTime}))};this.isSamplingSuccess=function(){if(_this._spdRate>=0&&_this._spdRate<=1){return Math.random()<=_this._spdRate}return true};this.sendFirstTime=function(){var _a;console.log('FCP this._firtTime::',_this._firtTime);var fcp=(_a=_this._firtTime[0])===null||_a===void 0?void 0:_a.timestamp;if(fcp){_this._spdTiming['fcp']={timestamp:fcp,fetchType:121,};_this.sendFMPTime(1,fcp)}};this.sendFMPTime=function(num,fcp){var _a;_this._firtTime.sort(function(a,b){return b.points-a.points});if(((_a=_this._firtTime[0])===null||_a===void 0?void 0:_a.timestamp)>fcp){console.log('FMP this._firtTime::',_this._firtTime);_this._spdTiming['fmp']={timestamp:_this._firtTime[0].timestamp,fetchType:122,};_this.report=true}else if(num<4){setTimeout(function(){num++;_this.sendFMPTime(num,fcp)},500*num)}else{_this.report=true}};this.getNodesPoints=function(nodes){var points=0;var getChildrenIdx=function(nodesChildren,pId){var idxAry=[];nodesChildren.map(function(node,idx){node.pId==pId&&idxAry.push(idx)});return idxAry};nodes.map(function(node){if(node.name=='ViewPager'){var childrenIdx=getChildrenIdx(nodes,node.pId);var viewPagerNodes=[];if(childrenIdx.length>1){viewPagerNodes=nodes.splice(childrenIdx[0],childrenIdx[1]-childrenIdx[0])}else{viewPagerNodes=nodes.splice(childrenIdx[0])}var viewPagerItemIdx=getChildrenIdx(viewPagerNodes,viewPagerNodes[1].pId);var viewPagerItemNodes=[];if(viewPagerItemIdx.length>1){viewPagerItemNodes=viewPagerNodes.splice(viewPagerItemIdx[0],viewPagerItemIdx[1]-viewPagerItemIdx[0])}else{viewPagerItemNodes=viewPagerNodes.splice(viewPagerItemIdx[0])}points+=_this.getNodesPoints(viewPagerItemNodes)}else if(node.name=='Image'&&node.props&&node.props.source&&node.props.source[0]&&node.props.source[0].uri){points+=2}else if(node.name=='Text'&&node.props&&node.props.text){points+=1}else if(node.name=='Svg'&&node.props&&node.props.d){points+=1}});return points};if(opts){this.init(opts)}}return SPD}());export default SPD;